<!-- Matt Bauchspies - - mbauch72@uw.edu-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <title>YuGiOmni</title>
</head>

<body>
    <!--Title of the webpage-->
    <div class="title col-sm-12 p-2 bg-secondary">
        <div class="container">
            <h3>YuGiOmni Card Database</h3>
            <p><a href="https://github.com/osDreamscape">Matt Bauchspies</a>, 
                <a href="https://github.com/jae253">Jacob Erickson</a>, 
                Elias Peterson <br>
            </p>
        </div>
    </div>

    <!--Container for the tabs the webpage utilizes-->
    <div class="container my-5">
        <!--Tabs for the webpage-->
        <nav>

            <div class="nav nav-tabs" id="nav-tab" role="tablist">

                <!--Home tab-->
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home"
                    type="button" role="tab" aria-controls="nav-home" aria-selected="true">Home</button>

                <!--Melee Accuracy Calculator tab-->
                <button class="nav-link" id="nav-accuracy-tab" data-bs-toggle="tab" data-bs-target="#nav-accuracy"
                    type="button" role="tab" aria-controls="nav-accuracy" aria-selected="false">Monster Cards</button>

                <!--Melee Defence Calculator tab-->
                <button class="nav-link" id="nav-defence-tab" data-bs-toggle="tab" data-bs-target="#nav-defence"
                    type="button" role="tab" aria-controls="nav-defence" aria-selected="false">Trap Cards</button>

                <!--Melee DPS Calculator tab-->
                <button class="nav-link" id="nav-dps-tab" data-bs-toggle="tab" data-bs-target="#nav-dps" type="button"
                    role="tab" aria-controls="nav-dps" aria-selected="false">Spell Cards</button>

                <!--Queries tab-->
                <button class="nav-link" id="nav-query-tab" data-bs-toggle="tab" data-bs-target="#nav-query"
                type="button" role="tab" aria-controls="nav-query" aria-selected="false">Custom Query (advanced)</button>

            </div>

        </nav>
    </div>

    <!--Content for the individual tabs of the webpage-->
    <div class="tab-content" id="nav-tabContent">

        <!--Home tab content-->
        <div class="tab-pane fade show active p-3" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            <img src="logo.png" class="center">
            <h1>About this page:</h1>
            <p>This page utilizes a Google Cloud hosted MySQL database, as well as Express, Apache, and Node.js to send
                API requests in order to communicate with the database for SQL queries.</p>
        </div>

        <!--query tab content-->
        <div class="tab-pane fade p-3" id="nav-query" role="tabpanel">
            <h1>Arbitrary query</h1>
            <div class="query-container">
                <form>
                    <fieldset>
                        <legend>Select attributes to select:</legend>
                      
                        <div>
                          <input type="checkbox" id="scales" name="scales" checked />
                          <label for="scales">Card Name</label>
                          <input type="checkbox" id="horns" name="horns" />
                          <label for="horns">Card ID</label>
                        </div>
                      </fieldset>
                    <div class="mb-3">
                        <!--Text entry for the attribute(s)-->
                        <label for="select" class="form-label">SELECT:</label>
                        <input type="text" class="form-control" id="select" placeholder="card_name, card_id">
                    </div>

                    <!-- <div class="mb-3">
                        <label for="from" class="form-label">FROM:</label>
                        <input type="text" class="form-control" id="from" placeholder="card_names">
                    </div> -->
                    <div class="mb-3">
                        <!--Select from some predefined boosts of defence, if any-->
                        <label for="from" class="form-label">From:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg boost"
                            id="from">
                            <option value="card_names" selected>Card Names</option>
                            <option value="monster_cards">Monster Cards</option>
                            <option value="spell_cards">Spell Cards</option>
                            <option value="trap_cards">Trap Cards</option>
                            <option value="set_names">Set Names</option>
                            <option value="card_sets">Card Sets</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <!--Text entry for the where constraints-->
                        <label for="where" class="form-label">WHERE:</label>
                        <input type="text" class="form-control" id="where" placeholder="card_name='Pot of Greed'">
                    </div>

                </form>
                <h3>Arbitrary query results:</h3>
                <!--Output of the calculations-->
                <button type="submit" class="btn btn-primary" id="querysubmit">Execute query</button>
                <table id="query-results"></table>

            </div>
        </div>


        <!--Accuracy tab content-->
        <div class="tab-pane fade p-3" id="nav-accuracy" role="tabpanel" aria-labelledby="nav-accuracy-tab">
            <h1>Monster Cards</h1>
            <div class="accuracy-container">
                <form>
                    <div class="mb-3">
                        <!--Text entry for attack level of the character-->
                        <label for="attacklevel" class="form-label">Attack level:</label>
                        <input type="number" class="form-control" id="attacklevel" aria-describedby="attacklevel"
                            min="0" placeholder="1">
                    </div>
                    <div class="mb-3">
                        <!--Select from predefined boosts for attack, if any-->
                        <label for="attackboost" class="form-label">Boosts:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg boost"
                            id="attackboost">
                            <option value="none" selected>None</option>
                            <option value="attackpotion">Attack potion</option>
                            <option value="superattackpotion">Super attack potion</option>
                            <option value="overload">Overload+</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <!--Text entry for the attack bonus of the type used, if any-->
                        <label for="attackbonus" class="form-label">Attack bonus:</label>
                        <input type="number" class="form-control" id="attackbonus" aria-describedby="attackbonus"
                            placeholder="0">
                    </div>
                    <div class="mb-3">
                        <!--Select from predefined prayers for attack used, if any-->
                        <label for="attackprayer" class="form-label">Prayer:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg prayer"
                            id="attackprayer">
                            <option value="0" selected>None</option>
                            <option value="5">Clarity of Thought</option>
                            <option value="10">Improved Reflexes</option>
                            <option value="15">Incredible Reflexes</option>
                            <option value="15">Chivalry</option>
                            <option value="20">Piety</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <!--Select from some combinations of sets, if any-->
                        <label for="attackset" class="form-label">Set:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg set" id="attackset">
                            <option value="none" selected>None</option>
                            <option value="void">Void</option>
                            <option value="voidsalve">Void + Salve</option>
                            <option value="voidsalvee">Void + Salve (e)</option>
                            <option value="slayer">Slayer helm/Black mask</option>
                            <option value="salve">Salve</option>
                            <option value="salvee">Salve (e)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <!--Select the attack style used-->
                        <label for="attackstyle" class="form-label">Style:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg boost"
                            id="attackstyle">
                            <option value="3" selected>Accurate</option>
                            <option value="0">Aggressive</option>
                            <option value="1">Controlled</option>
                            <option value="0">Defensive</option>
                        </select>
                    </div>
                </form>
                <h3>Accuracy: </h3>
                <!--The calculated accuracy roll-->
                <h1 id="calculatedaccuracy">0</h1>
                <button type="submit" class="btn btn-primary" id="accuracysubmit">Calculate Accuracy Roll</button>
            </div>
        </div>

        <!--Defence tab content-->
        <div class="tab-pane fade p-3" id="nav-defence" role="tabpanel" aria-labelledby="nav-defence-tab">
            <h1>Melee Defence Roll</h1>
            <div class="defence-container">
                <form>
                    <div class="form-check">
                        <!--Checkbox for if the defending character is a monster, as this affects calculations-->
                        <input class="form-check-input" type="checkbox" value="" id="monstercheck">
                        <label class="form-check-label" for="monstercheck">
                            Monster?
                        </label>
                    </div>
                    <div class="mb-3">
                        <!--Text entry for the character's defence level-->
                        <label for="defencelevel" class="form-label">Defence level:</label>
                        <input type="number" class="form-control" id="defencelevel" aria-describedby="defencelevel"
                            min="0" placeholder="1">
                    </div>
                    <div class="mb-3">
                        <!--Select from some predefined boosts of defence, if any-->
                        <label for="defenceboost" class="form-label">Boosts:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg boost"
                            id="defenceboost">
                            <option value="none" selected>None</option>
                            <option value="defencepotion">Defence potion</option>
                            <option value="superdefencepotion">Super defence potion</option>
                            <option value="saradominbrew">Saradomin brew</option>
                            <option value="overload">Overload+</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <!--Text entry for the defence gear bonus of the respective type, if any-->
                        <label for="defencebonus" class="form-label">Defence bonus:</label>
                        <input type="number" class="form-control" id="defencebonus" aria-describedby="defencebonus"
                            placeholder="0">
                    </div>
                    <div class="mb-3">
                        <!--Select from a number of predefined defensive prayers used, if any-->
                        <label for="defenceprayer" class="form-label">Prayer:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg prayer"
                            id="defenceprayer">
                            <option value="0" selected>None</option>
                            <option value="5">Thick Skin</option>
                            <option value="10">Rock Skin</option>
                            <option value="15">Steel Skin</option>
                            <option value="20">Chivalry</option>
                            <option value="25">Piety</option>
                            <option value="25">Rigour</option>
                            <option value="25">Augury</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <!--Select style used-->
                        <label for="defencestyle" class="form-label">Style:</label>
                        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg boost"
                            id="defencestyle">
                            <option value="0" selected>Accurate</option>
                            <option value="0">Aggressive</option>
                            <option value="1">Controlled</option>
                            <option value="3">Defensive</option>
                        </select>
                    </div>
                </form>
                <h3>Defence: </h3>
                <!--The calculated defence roll-->
                <h1 id="calculateddefence">0</h1>
                <button type="submit" class="btn btn-primary" id="defencesubmit">Calculate Defence Roll</button>
            </div>
        </div>

        <!--DPS tab content-->
        <div class="tab-pane fade p-3" id="nav-dps" role="tabpanel" aria-labelledby="nav-dps-tab">
            <h1>Melee DPS</h1>
            <div class="dps-container">
                <!--Hit chance utilizes the accuracy and defence rolls to determine hit percentage-->
                <p>Note: this uses the accuracy and defence tabs' info</p>
                <button type="submit" class="btn btn-primary" id="hitchancesubmit">Calculate Hit Chance</button>
                <!--The calculated hit chance-->
                <h2 id="calculatedhitchance">0</h2>
                <p>Note: this uses the max hit, accuracy, and defence tabs' info</p>
                <form>
                    <div class="mb-3">
                        <!--Attack speed in game ticks, usually ranges between 2 and 7-->
                        <label for="attackspeed" class="form-label">Attack speed:</label>
                        <input type="number" class="form-control" id="attackspeed" aria-describedby="attackspeed"
                            min="1" max="10" placeholder="4">
                    </div>
                </form>
                <!--Calculates a max hit utilizing hit chance, max hit, and attack speed-->
                <button type="submit" class="btn btn-primary" id="dpssubmit">Calculate DPS</button>
                <!--The calculated DPS-->
                <h2 id="calculateddps">0</h2>
            </div>
        </div>

    </div>


    <!--import bootstrap and jquery at the end to load page quicker-->
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
</body>
<script>
    RESTAPI = `http://127.0.0.1:3000`

    // Sends a request to the localhost API to calculate the max hit
    $("#querysubmit").click(function () {
        const selection = $("#select").val();
        const from = $("#from").val();
        const where = $("#where").val();

        let executequery = RESTAPI + "/select" + "/" + selection + "/" + from;
        if(where !== "") executequery += "/" + where;
        else executequery += "/none";

        $.get(executequery).then(data => {
            let result = "<tr>"
            for(const name of Object.keys(data[0])) {
                let newName = ""
                name.split("_").map(word => {
                    newName += word[0].toUpperCase() + word.substr(1) + " ";
                })
                result += "<th>" + newName + "</th>";
            }
            result += "</tr>"
            for(const element of data) {
                result += "<tr>";
                var vals = Object.keys(element).map(function (key) {
                    result += "<td>" + element[key] + "</td>";
                });
                result += "</tr>";
            }
            $("#query-results").html(result);
        }).fail(() => {
            $("#query-results").html("Error, check your query parameters. <br>" + executequery);
        });
    });

    // Sends a request to the localhost API to calculate the accuracy roll
    $("#accuracysubmit").click(function () {
        const level = $("#attacklevel").val();
        const boost = $("#attackboost").val();
        const bonus = $("#attackbonus").val();
        const prayer = $("#attackprayer").val();
        const set = $("#attackset").val();
        const style = $("#attackstyle").val();

        let accuracyrequest = RESTAPI + "/meleeaccuracy" + "/" + level + "/" + boost + "/" + bonus + "/" + prayer + "/" + set + "/" + style;
        $.get(accuracyrequest).then(data => {
            let accuracy = data.accuracy_roll;
            $("#calculatedaccuracy").html(accuracy);
        });
    });

    // Sends a request to the localhost API to calculate the defence roll
    $("#defencesubmit").click(function () {
        const level = $("#defencelevel").val();
        const boost = $("#defenceboost").val();
        const bonus = $("#defencebonus").val();
        const prayer = $("#defenceprayer").val();
        const style = $("#defencestyle").val();

        let monster;
        if ($('#monstercheck').is(':checked')) {
            monster = 1;
        } else {
            monster = 0;
        }

        let defencerequest = RESTAPI + "/meleedefence" + "/" + level + "/" + boost + "/" + bonus + "/" + prayer + "/" + style + "/" + monster;
        $.get(defencerequest).then(data => {
            let defenceroll = data.defence_roll;
            $("#calculateddefence").html(defenceroll);
        });
    });

    // Sends a request to the localhost API to calculate the hit chance
    $("#hitchancesubmit").click(function () {
        const accuracy = $("#calculatedaccuracy").html();
        const defence = $("#calculateddefence").html();

        let hitchancerequest = RESTAPI + "/meleehitchance" + "/" + accuracy + "/" + defence;
        $.get(hitchancerequest).then(data => {
            let hitchance = data.hitchance;
            $("#calculatedhitchance").html(hitchance);
        });
    });

    // Sends a request to the localhost API to calculate the hit chance
    $("#dpssubmit").click(function () {
        const hitchance = $("#calculatedhitchance").html();
        const maxhit = $("#calculatedmax").html();
        const attackspeed = $("#attackspeed").val();


        let dpsrequest = RESTAPI + "/meleedps" + "/" + hitchance + "/" + maxhit + "/" + attackspeed;
        $.get(dpsrequest).then(data => {
            let dps = data.DPS;
            $("#calculateddps").html(dps);
        });
    });
</script>

</html>
